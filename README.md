Внимание! Чтобы скрипт работал проверьте что у вас совпадает логин и пароль для администратора перед выполнением, они прописаны в скриптах, если у вас они Administrator:P@ssw0rd, то все окей! Если нет, измените на свои. Запуск скрипта производить только после того как были установлены и выполнены все настройки связанные с Samba предшествующие этому подпункту задания.

Скрипт был протестирован на /opt/users.csv с BR-SRV, с типом переменных вида: First Name;Last Name;Role;Phone;OU;Street;ZIP/Postal;City;Country/Region;P@ssw0rd

Необходимые компоненты для работы скрипта:

Установить openldap-clients и pip + setproctitle

apt-get install openldap-clients pip -y

pip install setproctitle

Скачать репозиторий.

Использовать команду из before_script для обоих скриптов.

Сделать файлы исполняемыми chmod +x имя_скрипта.

Запустить скрипты ./имя_скрипта /opt/users.csv (Сначала запустить import, после полного выполнения запустить recovery, после его выполнения можно проверить возможность входа в учетки по паролю из /opt/users.csv (везде P@ssw0rd1).

Желательно проверять самую последнюю импортированную учетную запись, это - syorg:P@ssw0rd1

Совокупное время выполнения обоих скриптов ~20 минут, пока они выполняются можно сделать очет по другим заданиям или сделать другие задания, напимер настроить chrony и raid на других машинах, запустить развертывание moodle на HQ-SRV.

P.S - Не стоит пугаться того что import.sh удаляет пользователей при запуске скрипта, он удаляет только пользователей если они прописаны в файле /opt/users.csv, это нужно на всякий случай если вы что-то сделаете не так, то скрипт зачистит криво импортированных пользователей, несмотря на то что вывода от команды нет после начала удаления пользователей, скрипт работает, если пользователи из списка /opt/users.csv не будут найдены в AD/Samba, то после очистки, начнется вывод информирующий о добавлении пользователей.
